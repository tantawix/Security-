# Implementing Public Key Infrastructure

## PUBLIC AND PRIVATE KEY USAGE

### Public key cryptography

-دا النوع التاني من ال encryption اللي هو asymmetric ساعات بنقول عليه كدا برضو عادي

- لو حد عاوز يبعتلي حاجه فا انا ببعتلو ال public key بتاعي وهو يشفر بيه الملف اللي هيبعتهولي ولما يبعتهولي انا بقدر اعمله decrypt بواسطة ال private key بتاعي وكدا انا حققت مبدأ ال Confidentiality
- طيب لو انا بقي عاوز اتأكد من الجهاز اللي بتواصل معاه واعمل Authentication للجهاز اللي بتواصل معاه فا انا بشفر البيانات ب ال private key وانا ببعتلو ال public key عشان يقدر يعمل decrypt او فك تشفير

public key (encryption) —> private key (decryption) = Confidentiality

private key (encryption) —> public key (decryption) = Authentication

- انما بالنسبه لعملية ال authentication ممكن شخص يخاف يتعامل بيها لو انا ارسلت لحد ال private key عشان كدا ممكن اتعرض لهجمات زي ال MITM ويقدر الهاكر انو يأكسس علي المفتاح بتاعي ويعرف كل حاجه عشان كدا بنلجأ لل Public Key Infrastructure طب يعني ايه؟ تعالي اقولك
- انت دلوقتي لما تيجي تفتح موقع معين زي الفيسبوك مثلا انا كا يوزر ايه اللي يثبتلي انك فيسبوك اللي بجد مش واحد بيخدعني فا عملنا حاجه اسمها Digital Certificate بتكون فالموقع وفيها كل حاجه تخص الموقع زي ال domain , public key , exp date , hash public key type
- اللي بيصدر الشهاده دي بتكون جهه اسمها Certificate Authority - CA

### ازاي كل ده بيتم؟

1- مثلا موقع زي twitter  , هيروح تويتر رايح لل CA عشان تويتر باعتله حاجه اسمها CSR ودا طلب بأخد الشهاده وبيكون في كل المعلومات اللي تخص الموقع هيروح ال CA مراجع كل المعلومات دي ويتأكد منها ولو تمام هيديلو الشهاده

2- لو في بقي جهاز عادي بيتصفح وعاوز يفتح twitter هيروح الجهاز باعت HTTP Request للتويتر هيروح ال twitter باعت HTTP Response فيها صفحة الموقع + الشهاده او ال Digital Certificate واللي فيها بقي كل تفاصيل الموقع عشان اتأكد فعلا اني ده تويتر الاصلي مش حد بيخدعني

---

## CERTIFICATE AUTHORITIES TYPES

-الجهه المسؤوله عن اصدار ال Digital Certificate للمواقع او للاشخاص

### 1- Private CA

ودي ان تكون الشبكه الخاصه بالشركه بيكون فيها سيرفر بيقدملي الشهادات دي عشان اعمل شهاده لكل موظف او للاجهزه ودا بيكون عن طريق windows server

### 2- Public CA

ودا ان يكون موقع بقا عام يقدر من خلاله اي حد انو يطلع شهاده سواء للاجهزه او الافراد مواقع زي :

- IdenTrust
- Digicert
- Comodo
- GoDaddy
- GlobalSign

### SSL Protocol

-لن نتكلم فيه بشكل تفصيلي ولكن ستجد ان شهادات ال PKI فيها ال SSL او تحمل اسمها , الن الشهادة عندما يتم ارسالها يتم ارسالها ببروتوكول ال SSL , بحيث لما نريد ارسال الشهادة لل Client ونريد ان نجميها من ان ياخذها اي شخص بحيث , من يحصل على الشهادة هو الكومبيوتر , لذلك البروتوكول هذا هو الخاص بهذه المهمة , والبروتوكول كبير وسيكون له شرح اخر مفصل

---

## PKI TRUST MODELS

### Single CA

- هنا بيبقى فيه جهة واحدة (CA) اللي بتصدر الشهادات الرقمية للمستخدمين.
- المستخدمين بيثقوا في الشهادات الصادرة من الجهة دي بس.
- العيب هنا إنه لو الـ CA ده اتعرض للاختراق، الـ PKI كله بيقع؛ مفيش جهة تانية يعتمد

### Hierarchical (Intermediate CA)

وهو ال CA الهرمي . بحيث يكون مقسم الى :
Root -1 - دا الCA الام اللي بيكون فوق الكل
Leaf-2 - دا الCA اللي بيكون اخر واحد

- في النموذج ده، بيبقى فيه CA رئيسي اسمه **Root CA**، وده بيصدر شهادات لجهات وسيطة اسمها **Intermediate CAs**.
- الـ Intermediate CAs دي هي اللي بتصدر الشهادات النهائية للمستخدمين.
- الميزة هنا إن كل جهة وسيطة تقدر تحط سياسات معينة للشهادات اللي بتصدرها، فالمستخدمين يقدروا يعرفوا الشهادة دي مصممة لمين أو لأي غرض.
- كمان فيه حاجة اسمها **سلسلة الثقة** (Chain of Trust)، اللي بتخلي أي شهادة نهائية ممكن تتعقبها وترجع للـ Root CA.
- الـ Root CA بيبقى عليه شهادة **موقعة ذاتيًا** (self-signed).
- عيب النموذج ده إنه، رغم إن فيه جهات وسيطة، برضه لو الـ Root CA حصل له مشكلة أو اتعرض للاختراق، البناء كله بينهار.

باختصار، نموذج **Single CA** بسيط لكن عليه خطر أكتر، أما **Hierarchical CA** بيوفر مرونة وسلسلة ثقة، بس الـ Root CA بيبقى برضه نقطة ضعف لو حصلت له مشكلة.

### Online vs Offline CAs

- **Online CA**:
    - شغال على طول ومتصل بالنت علشان يستقبل الطلبات بتاعة الشهادات الرقمية (Certificate Signing Requests) ويعمل إدارة للشهادات.
    - بيقدر ينشر قوائم إلغاء الشهادات (Certificate Revocation Lists - CRLs) ويتابع إدارة الشهادات في الوقت الفعلي.
    - بس وجوده دايمًا أونلاين بيعرضه أكتر للاختراق والهجمات.
- **Offline CA**:
    - ده بيبقى الـ Root CA، واللي بيتحفظ بشكل آمن ومش متوصل بأي شبكة.
    - بيكون مطفي ومفصول عن الكهرباء علشان يقلل فرص الاختراق.
    - بس لازم يتوصل ويشتغل فترة مؤقتة لما نحتاج نضيف أو نعدل في الـ Intermediate CAs (الشهادات الوسيطة).

الفكرة إن الـ Offline CA بيكون أكتر أمان، عشان مش شغال طول الوقت ولا متوصل بالنت

---

## REGISTRATION AUTHORITIES AND CSRS

- خطوات الحصول علي Digital Certificate
1. اعمل حساب في ال CA 
2. تبعت طلب توقيع ودا بيكون من خلال بروتوكول ال CRS
3. بعد كدا ادخل المعلومات اللازمه للموقع بتاعي عشان اثبت اني فعلا دا الموقع الحقيقي ويتوقعلي عليها

### CERTIFICATE REVOCATION LISTS (اسباب وقف الشهاده)

1- الشهاده حصلها اختراق

2- الموقع قفل خلاص ومبقاش موجود

3- صاحب الشهاده اختفي او مات

4- الموظف واخد اجازه ودا ممكن اعمل وقف جزئي للشهاده وارجع اشغلها تاني لما الموظف دا يرجع

5- الدومين اتغير

6- اسائه استخدام الشهاده

---

*من الاخر , الشهاده بكل اختصار بتحمي ال private key من الكشف , والصد ضد هجمات ال MITM وبتكون للاشخاص او الاجهزه زي السيرفرات او المواقع اللي بتكون علي السيرفرات ودي بتكون بصيغه X.509 ومنظمه ال IETF دي المعترف بيها*

---