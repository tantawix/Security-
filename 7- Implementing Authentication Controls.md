# Implementing Authentication Controls

## IDENTITY AND ACCESS MANAGEMENT

- **Access Control System (ACS)** :

-بعض التحكمات اللي بيعملها ال Admin عشان يقدر يتحكم في ال Subject وال Object

- **Subject** : دا الشخص اللي بيبقي عندي ف المؤسسه وطالب اكسس علي حاجه معينه
- **Object** : دي الحاجه اللي الشخص طالب انو يأكسس عليها

*مثال للتوضيح :
لو انا اريد اخذ access على السيرفر هذا شئ يسمى subject بحيث الشخص طلب , فقام السيرفر بالرد عليا باني يجب ان ادخل ال pass وال user مثال , هذا يسمى ال object , هذه العملية تسمى ACS , بحيث تقوم بجعل ال object اليذهب اال لم تتاكد من انه ال Subject الصحيح اللي هو صاحب الشئ ,بحيث ال ACS تقوم بعمل control كامل لمنع اي شخص اخر بالدخول واتخاذ االجراء ,وهذا يعتبر اساس المؤسسات الكبيرة والصغيرة ايضا*

### Identity and Access Management

-دا نظام بيكون جوا ال ACS ودا اللي بيتحكم ف كل حاجه طب هو بيعمل ايه؟ تعالي اقولك

- **Identification**

-دي الخطوه اللي بنشأ فيها حساب جديد للموظف وبعملو id و user مميزين ليه عشان يقدر انو يخش علي السيستم او الشبكه

- **Authentication**

-ودي خطوة اثبات الشخصيه اللي بدخل فيها المعلومات اللي أخدتها من ال identification عشان لما بدخل ال user وال pass مثلا بيقولي تمام انت الشخص فعلا ده خش

- **Authorization**

-ودي مرحله بحدد فيها الصلاحيات والحقوق الخاصه بالموظف ده عشان طبعا لو فاكرين ف مبدأ ال Integrity اني مش اي حد يقدر يأكسس علي اي حاجه فالسيستم لأ كل شخص بيكون ليه صلاحيات معينه فا انا بعمل كدا ف الخطوه دي

- **Accounting**

-دي بقا مرحله بقدر اتتبع منها اي حاجه بيعملها الموظف من خلال ال Audit Log عشان اتابع لو بيحاول انو يعمل حاجه مخالفه او unauthorized فا اقفشو علاطول لو فاكرين دا مبدأ ال non-repudiation

![image.png](image.png)

بص يا يسطا، خلينا نشرح الموضوع بشكل بسيط. الفكرة من **التوثيق (Authentication)** هي إنك تتأكد إن اللي بيحاول يدخل الحساب هو صاحب الحساب الأصلي، وإن الحساب ده مش مسموح لأي حد غيره يدخل عليه.

**إزاي بيتم ده؟**

لما صاحب الحساب يدخل بيانات معينة (اللي بنسميها **الموثقات** أو **المصدقات** زي الباسورد أو بصمة الإصبع مثلاً)، النظام بيقارن الموثقات دي بالبيانات اللي موجودة عنده في النظام. لو المعلومات اللي دخلها الشخص متطابقة مع اللي النظام حافظها، يبقى النظام بيتأكد إن الشخص ده هو صاحب الحساب ويديله صلاحية الدخول.

**يعني الموضوع بيتلخص في كام نقطة:**

1. صاحب الحساب بيقدم معلومات معينة أو **موثقات**.
2. النظام بيقارن الموثقات دي بالمعلومات المخزنة عنده.
3. لو المعلومات متطابقة، يبقى الشخص بيدخل على الحساب.

**أنواع الموثقات (أو العوامل):**

فيه تقنيات كتير لعمل الموثقات دي وبتتقسم لفئات معينة، زي:

- **حاجة تعرفها** (مثلاً الباسورد).
- **حاجة تمتلكها** (زي كارت معين أو جهاز).
- **حاجة تتعلق بيك** (زي بصمة الإصبع أو بصمة العين).

والفكرة إن العوامل دي بتساعد في تعزيز الأمان عشان تمنع أي حد غير صاحب الحساب من الدخول.

---

## AUTHENTICATION FACTORS

- **Something You Know Authentication**

-دي حاجه بكون انا عارفها او حاجه عاملها زي 

1. username and password
2. PIN
3. Swipe Pattern (نمط التليفون)

- **Something You Have Authentication**

-دي حاجه بتكون معاك وبتقدر تدخل بيها زي

1. Smart Card
2. fob (زي مفتاح العربيه مثلا او شفرة الاسانسير)
3. hard token (ودا جهاز كدا بيتبعتلك عليه رقم سري وبتدخل بيه)

- **Something You Are/Do Authentication**

-ودي حاجه انت بتعملها زي 

1. fingerprint
2. gait (طريقة المشي)
3. behavioral identifiers (سلوك الشخص)

---

## MULTIFACTOR AUTHENTICATION

-دي طريقة authentication بستخدم فيها طريقتين من اللي التلاته اللي ذكرناهم فوق

- **Two-Factor Authentication (2FA)**

-هدمج فيها طريقتين زي مثلا ال password مع ال hard token

-يعني مثلا لما تيجي تسجل ف اي تطبيق دلوقتي بتدخل email and pass وبعد ماتدخلهم بيروح باعتلك كود علي الموبايل تدخلو يروح الاكونت بتاعك مفتوح دا لو انت مفعل ال 2FA

- **Three-factor authentication**

-ودي بقي بدمج فيها بين التلت طرق اللي قولناهم فوق ودي بتكون اكثر أمانا

---

## LOCAL, NETWORK, AND REMOTE AUTHENTICATION

### Windows Authentication

- **تسجيل الدخول المحلي (Windows Local Sign-in):**
    
    في الحالة دي، **هيئة الأمن المحلية (LSA)** بتقارن البيانات اللي المستخدم دخلها مع **هاش** محطوط في قاعدة بيانات **Security Accounts Manager (SAM)** اللي موجودة في الريجستري (الريجيستري ده زي قاعدة بيانات للنظام).
    
- **تسجيل الدخول للشبكة (Windows Network Sign-in):**
    
    هنا، **الـLSA** ممكن تبعت بيانات المستخدم لتوثيقها على خدمة الشبكة. النظام المفضل للتوثيق في الشبكة هو **Kerberos**، لكن في بعض التطبيقات القديمة بتستخدم **NT LAN Manager (NTLM)**.
    
- **تسجيل الدخول عن بعد (Remote Sign-in):**
    
    لو جهاز المستخدم مش متوصل بالشبكة المحلية، التوثيق بيتم عن طريق شبكة خاصة افتراضية **(VPN)** أو بوابة ويب (Web Portal).
    

### Linux Authentication

- **حسابات المستخدمين في لينكس** بتكون متخزنة في ملف اسمه **/etc/passwd**.
- **لما المستخدم يدخل على الجهاز بشكل مباشر**، الباسورد بيتقارن مع **هاش** متخزن في ملف اسمه **/etc/shadow** عشان يتأكدوا إنه صح.
- **لو بيدخل عن طريق الشبكة**، بيستخدم عادةً بروتوكول اسمه **SSH** (Secure Shell) عشان الأمان.
- مع **SSH**، المستخدم ممكن يتوثق باستخدام **مفاتيح تشفير** بدل الباسورد، وده بيزود الأمان بشكل كبير.

### Single sign-on (SSO)

- **نظام تسجيل الدخول الموحد (Single Sign-On - SSO)** بيخلي المستخدم يدخل بياناته مرة واحدة على الجهاز المحلي، وبعدها يقدر يتوصل لكل السيرفرات والتطبيقات المتوافقة من غير ما يحتاج يدخل بياناته تاني كل مرة.
- **في ويندوز**، نظام الـSSO شغال من خلال **إطار عمل Kerberos** اللي بيقوم بعملية التوثيق بشكل آمن وسريع.

### KERBEROS AUTHENTICATION

خلينا نشرح موضوع **Kerberos** بشكل مبسط:

1. **الKerberos** هو بروتوكول بيستخدمه نظام **Active Directory** في ويندوز، وده بيخليك تسجل دخول مرة واحدة بس (Single Sign-On) وتكون موثّق لكل التطبيقات والخدمات في الشبكة.
2. **اسم البروتوكول مستوحى من سيربيروس** (كلب حراسة ثلاثي الرؤوس)، لأنه بيتكون من 3 أجزاء:
    - **العميل (Client)** اللي عايز يدخل على خدمة معينة.
    - **سيرفر الخدمة (Application Server)** اللي العميل عايز يوصل له.
    - **مركز توزيع المفاتيح (Key Distribution Center - KDC)**، اللي دوره يضمن إن العميل هو الشخص المصرح له.
3. **الـ KDC** بيشمل خدمتين رئيسيتين:
    - **خدمة التوثيق (Authentication Service)**، اللي بتتحقق من طلبات تسجيل الدخول.
    - **خدمة منح التذاكر (Ticket Granting Service - TGS)**، اللي بتوزع تذاكر السماح بالدخول للخدمات.
4. الـKDC بيشتغل على **البورت 88** باستخدام بروتوكولات TCP أو UDP.

### خطوات التوثيق في Kerberos:

1. **العميل بيبعت طلب** لخدمة التوثيق (AS) عشان ياخد **تذكرة اسمها TGT (Ticket Granting Ticket)**. الطلب ده بيكون مشفّر باستخدام **هاش الباسورد** الخاص بالمستخدم.
2. **خدمة التوثيق (AS)** بتتحقق من:
    - إن حساب المستخدم موجود.
    - إن الطلب صحيح وممكن فك تشفيره.
    - إن الطلب مش منتهي الصلاحية.
3. لو الطلب صحيح، **خدمة التوثيق (AS)** بتبعت للعميل:
    - **تذكرة TGT**، ودي فيها معلومات عن العميل (زي الاسم وعنوان الـ IP) وفترة صلاحية.
    - **مفتاح جلسة TGS**، اللي هيتستخدم للتواصل بين العميل وخدمة منح التذاكر (TGS)، وده بيكون مشفّر بهاش باسورد المستخدم.
    
    ---
    

## PAP, CHAP, AND MS-CHAP AUTHENTICATION

### Password Authentication Protocol

-دا بروتوكول لو عاوزين نبعت معلومات الهويه لحد عشان نثبت الشخص ده للسيرفر , ودا اول بروتوكول مختص للعمليه دي بس هو مش مشفر وبيبعت البيانات plain text فا هو غير امن تماما لذلك هو مهدد لهجمات زي ال MITM

### Challenge Handshake Authentication Protocol (CHAP)

-دا بيعمل نفس اللي ال PAP بيعملو بس ده مشفر وامن وشغال مع اي نظام عادي ومن اي نظام لنظام عادي

### MS-CHAP V2

-ودا خاص بأجهزه الويندوز بس

---

## Password Attacks

### أنواع هجمات الباسورد

1. **هجمات النص الصريح/غير المشفّر (unencrypted/plaintext Attacks)**
    - دي هجمات بتستغل بروتوكولات اللي بتبعت الباسوردات من غير تشفير زي **PAP**، **HTTP/FTP البسيط**، و**Telnet**.
    - البروتوكولات دي تعتبر غير آمنة ولازم تتجنب استخدامها.
2. **هجمات الأونلاين (Online Attacks)**
    - دي الهجمات اللي بيحاول فيها الهاكر إنه يدخل مباشرةً من خلال خدمة زي موقع تسجيل دخول أو بوابة VPN.
    - ممكن يستخدم قواعد بيانات فيها باسوردات شائعة أو مسربة.
3. **هجمات الأوفلاين (Offline Attacks)**
    - في الهجمات دي، الهاكر بيحصل على قاعدة بيانات الباسوردات (زي ملف SAM في ويندوز أو /etc/shadow في لينكس) ويكسر التشفير من غير ما يتفاعل مباشرةً مع النظام.

### طرق كسر الباسوردات

1. **هجوم القوة الغاشمة (Brute-Force Attack)**
    - ده بيجرب كل الاحتمالات الممكنة لغاية ما يلاقي الباسورد. الهجمات دي محتاجة وقت وطاقة، لكن لو عنده أجهزة قوية ممكن يكسر باسوردات أطول.
2. **هجوم القاموس (Dictionary Attack)**
    - هنا بيجرب كلمات شائعة موجودة في القاموس، وبيدور على هاش مطابق لها.
3. **هجوم جداول القوس قزح (Rainbow Table Attack)**
    - بيستخدم جدول فيه هاشات مسبقة محسوبة للباسوردات. الهجوم ده أسرع، لكن لو تم استخدام **ملح (salt)** في الحفظ، بيصعّب الهجوم ده.
4. **هجوم الهجين (Hybrid Attack)**
    - ده مزيج بين هجوم القاموس وهجوم القوة الغاشمة، وغالباً بيستهدف الباسوردات اللي فيها تعقيد بسيط زي كلمة مع رقم (زي james1).

### ملاحظات

- إضافة **الملح (salt)** للباسوردات بيزود الأمان، عشان يوقف هجمات جداول القوس قزح.

---

## PASSWORD CRACKERS

أدوات كسر الباسوردات بتساعد الهاكرز على فك تشفير الباسوردات المشفرة في قواعد البيانات، ودي ملخص لأهم الأدوات والأساليب:

1. **أدوات في ويندوز**
    - في ويندوز، فيه أدوات معروفة زي **Cain** و **L0phtcrack**، لكنها أقل شيوعاً من أدوات لينكس.
2. **أدوات في لينكس**
    - معظم أدوات كسر الباسوردات بتشتغل على لينكس، زي **Hashcat**، اللي بتعتبر أداة قوية لكسر هاشات الباسوردات.
3. **طريقة استخدام Hashcat**
    - الأمر الأساسي لتشغيل Hashcat:
        
        ```bash
        bash
        Copy code
        hashcat -m HashType -a AttackMode -o OutputFile InputHashFile
        ```
        
    - **HashType**: نوع الهاش اللي بيتم كسره، زي MD5 أو SHA.
    - **AttackMode**: وضع الهجوم، زي وضع القاموس (dictionary mode -a 0) أو وضع التوليف (combinator mode -a 1).
    - **OutputFile**: ملف الإخراج اللي هيتم فيه حفظ النتائج.
4. **ملف الإدخال**
    - ملف الإدخال لازم يكون فيه هاشات من نفس النوع، وممكن تلاقي أمثلة للهاشات في موقع Hashcat.
    
    ---
    

## BIOMETRIC AUTHENTICATION

### خطوات الـ Biometric Authentication:

1. **التسجيل (Enrollment)**
    - أول خطوة هي تسجيل بيانات بيومترية خاصة بالشخص، زي بصمة الإصبع (Fingerprint) أو الوجه (Facial Recognition)، وبتتحول لمعلومات رقمية.
    - عملية التسجيل فيها جزئين:
        - *جزء حساس* بياخد العينة البيومترية.
        - *جزء استخراج الخصائص* اللي بيسجل الصفات اللي بتعرف الشخص بشكل فريد.
2. **المطابقة (Matching)**
    - لما الشخص يحاول يسجل دخول، النظام بيقارن العينة البيومترية اللي خدها ببياناته المسجلة عشان يقدر يمنحه صلاحية الوصول لو حصل تطابق.

---

### أمثلة على الـ Biometric Authentication:

1. **التعرف على بصمة الإصبع (Fingerprint Recognition)**
    - الأكثر انتشاراً، لأنه بسيط ورخيص نسبياً، لكن الرطوبة أو الأوساخ ممكن تأثر عليه.
    - ممكن يتخدع لو حد نسخ البصمة، عشان كده في أجهزة متقدمة بتستخدم *مطابقة الأوعية الدموية (Vein Matching)* لضمان الأمان.
2. **التعرف على الوجه (Facial Recognition)**
    - بيتعرف على الوجه من خلال عدة مميزات زي المسافة بين العينين أو طول الأنف.
    - العيب إنه ممكن يكون فيه نسبة خطأ عالية، وممكن يتخدع، والموضوع بيحتاج إنارة مثالية خلال عملية التسجيل.
3. **مسح شبكية العين (Retinal Scan) والقزحية (Iris Scan)**
    - **شبكية العين (Retinal Scan):** أدق نوع لكنه معقد ومكلف وبيحتاج جهاز خاص عشان يقرأ الأوعية الدموية.
    - **قزحية العين (Iris Scan):** أسرع وأقل تعقيداً من الشبكية، ويعتبر أكتر انتشاراً في أماكن زي المطارات.

---

### تقنيات الـ Behavioral Biometric:

1. **التعرف على الصوت (Voice Recognition)**
    - رخيص لأنه بيشتغل على أجهزة عادية، لكن ممكن يتأثر بالضوضاء أو يتم تقليده.
2. **تحليل المشي (Gait Analysis)**
    - بيسجل حركة الشخص، وممكن يكون معتمد على كاميرات أو حساسات في الهاتف.
3. **التعرف على التوقيع (Signature Recognition)**
    - بيسجل السرعة والضغط أثناء كتابة التوقيع، لكن التوقيع نفسه ممكن يتقلد بسهولة.
4. **تحليل سرعة الكتابة (Typing Recognition)**
    - بيعتمد على سرعة ونمط كتابة الشخص لجملة معينة، وهي طريقة بتكون شخصية جداً لكنها معرضة للأخطاء.
    
    ---